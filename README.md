# mdview

ターミナルで Markdown を読みやすく表示するための高速 CLI ビューアです。Bubble Tea と Glamour をベースに、青を基調としたカスタムテーマと Vim ライクなキーバインドを備えています。内部構成を再設計し、起動時のレスポンスと保守性を大幅に高めました。

---

## 特長

- **Markdown レンダリング**: Goldmark → Glamour で整形。見出し階層は配色で統一感を保ち、コードは濃紺背景で強調。
- **2 ペイン構成**: 左にファイルツリー、右に本文ビュー。端末サイズに追従してリフローします。
- **遅延ロード・フィルタ済みツリー**: ツリーは必要な階層だけ `os.ReadDir` で動的に読み込み、Markdown を含まないディレクトリは自動的に非表示化。大量ファイルでも即座に立ち上がります。
- **Vim ライク操作**: `j/k`, `Ctrl+d/u`, `gg/G` などお馴染みのキーでスクロール。`Ctrl+h/l` でツリーと本文のフォーカスを切り替え。
- **ヘルプオーバーレイ**: `?` を押すと画面中央に主要キーバインドをポップアップ表示。
- **Markdown ツリー探索**: `.md` / `.markdown` のみを再帰列挙し、不要ディレクトリ（`.git`, `node_modules` など）は自動スキップ。

---

## 使い方

```bash
mdview <path>
```

- `<path>` がファイルの場合: 指定ファイルを即座に本文ペインへ表示します。
- `<path>` がディレクトリの場合: ツリーにフォーカスした状態で起動します。ファイルを選択するまで本文ペインは空のままです。

### ツリーでファイルを開く
1. `gg`, `G`, `j`, `k` でカーソル移動。
2. `l` または `Enter` でディレクトリを展開／ファイルを表示。
3. `h` でディレクトリを閉じます。
4. `Ctrl+l` で本文ペインへ戻り、同じキーバインドでスクロールできます。

---

## キーバインド一覧

| 分類 | キー | 説明 |
| --- | --- | --- |
| 共通 | `q`, `Ctrl+c` | 終了 |
| 共通 | `Ctrl+h`, `Ctrl+l` | ツリーと本文のフォーカス切替 |
| 共通 | `t` | ツリーペインの表示 / 非表示切替 |
| 共通 | `?` | ヘルプオーバーレイを表示 / 閉じる |
| ツリー | `j`, `k` | カーソル上下移動 |
| ツリー | `Ctrl+d`, `Ctrl+u` | 半ページ単位でカーソル移動 |
| ツリー | `l`, `Enter` | ディレクトリを開く / ファイルを表示 |
| ツリー | `h` | ディレクトリを閉じる |
| ツリー | `gg`, `G` | ツリーの先頭 / 末尾へ移動 |
| 本文 | `j`, `k` | 1 行スクロール |
| 本文 | `Ctrl+d`, `Ctrl+u` | 半ページスクロール |
| 本文 | `h`, `l` | 横スクロール |
| 本文 | `gg`, `G` | 先頭 / 末尾へジャンプ |

---

## 実装アーキテクチャ

- **トップレベル CLI** (`cmd/mdview/main.go`): コマンドライン引数の検証と `internal/app` の起動のみを担当。
- **アプリケーション層** (`internal/app`): 指定パスを解析して初期状態 (`ui.State`) を構築。ディレクトリ対象の場合は Markdown を含むかを事前検証し、見つからないときのメッセージ表示もここで制御。
- **UI 層** (`internal/ui`): Bubble Tea モデルを管理。ツリー／本文のビューポートやキーバインド、ヘルプオーバーレイなど TUI の振る舞いを統合。
- **ツリーデータ層** (`internal/tree`): ファイルツリーのノード構造とローダーを定義。`FSLoader` がディレクトリ内容を遅延読み込みし、Markdown 非含有ディレクトリを事前に除外。結果はメモリ上のキャッシュで高速化。

---

## 今後追加したい機能

1. **ファイルの自動リロード**  
   Markdown が更新された際に自動で反映するウォッチャー機能を検討する。
1. **カーソル移動**  
   Vim ライクな操作でInsertモード以外を実現。
   まずは基本的な以下の機能のみ。
   - リンクの上にカーソルがあるときにgxでブラウザで開く
   - yでコピー
   - vやCtrl+qなどでビジュアルモードや矩形選択を可能に
   - 検索系はなしで良い。
